1:HL["/llm-viz/_next/static/css/3f9906a34cd50113.css",{"as":"style"}]
0:["I5kIZmlAMiWjBiDL8K9gY",[[["",{"children":["cpu",{"children":["guide",{"children":["01-riscv-basic",{"children":["__PAGE__",{}]}]}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/llm-viz/_next/static/css/3f9906a34cd50113.css","precedence":"next"}]],"$L3"]]]]
4:HL["/llm-viz/_next/static/css/8ac2c1261f4ff59a.css",{"as":"style"}]
5:I{"id":7507,"chunks":["72:static/chunks/72-2a374614b0faac8e.js","185:static/chunks/app/layout-d798c07bb06580bd.js"],"name":"","async":false}
6:I{"id":7767,"chunks":["272:static/chunks/webpack-6bd05e46f7e97041.js","971:static/chunks/fd9d1056-f43907a98c85ee82.js","596:static/chunks/596-2fdce1dea939749a.js"],"name":"default","async":false}
7:I{"id":7920,"chunks":["272:static/chunks/webpack-6bd05e46f7e97041.js","971:static/chunks/fd9d1056-f43907a98c85ee82.js","596:static/chunks/596-2fdce1dea939749a.js"],"name":"default","async":false}
9:I{"id":841,"chunks":["676:static/chunks/870fdd6f-518e3e6340c51495.js","685:static/chunks/685-12db85c22c7fa2b2.js","72:static/chunks/72-2a374614b0faac8e.js","517:static/chunks/517-2fe68ec562ee32e2.js","893:static/chunks/893-d17ce508a4af9aa3.js","261:static/chunks/261-05f8894f64f4c9d8.js","678:static/chunks/678-5b35f6cae9351044.js","331:static/chunks/331-6f9b5543354b0e2f.js","144:static/chunks/app/cpu/guide/01-riscv-basic/page-1c476cedb8a69e7e.js"],"name":"CpuEnabledGuide","async":false}
a:I{"id":841,"chunks":["676:static/chunks/870fdd6f-518e3e6340c51495.js","685:static/chunks/685-12db85c22c7fa2b2.js","72:static/chunks/72-2a374614b0faac8e.js","517:static/chunks/517-2fe68ec562ee32e2.js","893:static/chunks/893-d17ce508a4af9aa3.js","261:static/chunks/261-05f8894f64f4c9d8.js","678:static/chunks/678-5b35f6cae9351044.js","331:static/chunks/331-6f9b5543354b0e2f.js","144:static/chunks/app/cpu/guide/01-riscv-basic/page-1c476cedb8a69e7e.js"],"name":"GuideSection","async":false}
b:I{"id":841,"chunks":["676:static/chunks/870fdd6f-518e3e6340c51495.js","685:static/chunks/685-12db85c22c7fa2b2.js","72:static/chunks/72-2a374614b0faac8e.js","517:static/chunks/517-2fe68ec562ee32e2.js","893:static/chunks/893-d17ce508a4af9aa3.js","261:static/chunks/261-05f8894f64f4c9d8.js","678:static/chunks/678-5b35f6cae9351044.js","331:static/chunks/331-6f9b5543354b0e2f.js","144:static/chunks/app/cpu/guide/01-riscv-basic/page-1c476cedb8a69e7e.js"],"name":"Para","async":false}
c:I{"id":8293,"chunks":["676:static/chunks/870fdd6f-518e3e6340c51495.js","685:static/chunks/685-12db85c22c7fa2b2.js","72:static/chunks/72-2a374614b0faac8e.js","517:static/chunks/517-2fe68ec562ee32e2.js","893:static/chunks/893-d17ce508a4af9aa3.js","261:static/chunks/261-05f8894f64f4c9d8.js","678:static/chunks/678-5b35f6cae9351044.js","331:static/chunks/331-6f9b5543354b0e2f.js","144:static/chunks/app/cpu/guide/01-riscv-basic/page-1c476cedb8a69e7e.js"],"name":"CpuCanvas","async":false}
d:I{"id":6973,"chunks":["676:static/chunks/870fdd6f-518e3e6340c51495.js","685:static/chunks/685-12db85c22c7fa2b2.js","72:static/chunks/72-2a374614b0faac8e.js","517:static/chunks/517-2fe68ec562ee32e2.js","893:static/chunks/893-d17ce508a4af9aa3.js","261:static/chunks/261-05f8894f64f4c9d8.js","678:static/chunks/678-5b35f6cae9351044.js","331:static/chunks/331-6f9b5543354b0e2f.js","144:static/chunks/app/cpu/guide/01-riscv-basic/page-1c476cedb8a69e7e.js"],"name":"AutoLoadCode","async":false}
e:I{"id":841,"chunks":["676:static/chunks/870fdd6f-518e3e6340c51495.js","685:static/chunks/685-12db85c22c7fa2b2.js","72:static/chunks/72-2a374614b0faac8e.js","517:static/chunks/517-2fe68ec562ee32e2.js","893:static/chunks/893-d17ce508a4af9aa3.js","261:static/chunks/261-05f8894f64f4c9d8.js","678:static/chunks/678-5b35f6cae9351044.js","331:static/chunks/331-6f9b5543354b0e2f.js","144:static/chunks/app/cpu/guide/01-riscv-basic/page-1c476cedb8a69e7e.js"],"name":"Ins","async":false}
2:[null,["$","$L5",null,{"children":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"childProp":{"current":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children","cpu","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":[null,[["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children","cpu","children","guide","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children","cpu","children","guide","children","01-riscv-basic","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$L8",["$","$L9",null,{"dir":0,"children":[["$","$La",null,{"title":"Introduction","children":["$","$Lb",null,{"children":"In this guide we'll build a minimal RISC-V computer, building on a few pre-made components. This will give you a basic understanding of how machine code (just an array of bytes) gets turned into a working computer. The RISC-V instruction set is a good first choice, as the design choices make it very simple to implement."}]}],["$","$La",null,{"title":"Instruction Set","children":[["$","$Lb",null,{"children":"The instruction set is the set of instructions the CPU can execute. Conveniently, each instruction in basic RISC-V is 4 bytes (32 bits) long."}],["$","$Lb",null,{"children":"Here's a table of a selection of some of the instructions we'll be using:"}],["$","div",null,{"className":"flex flex-col self-center w-[80%] py-4","children":[["$","div",null,{"className":"flex","children":[["$","div",null,{"className":"w-[9rem]","children":"add c a b"}],["$","div",null,{"children":"Add reg A to reg B; write result to reg C"}]]}],["$","div",null,{"className":"flex","children":[["$","div",null,{"className":"w-[9rem]","children":"addi c a imm"}],["$","div",null,{"children":"Add 20bit signed imm to reg A; write result to reg C"}]]}],["$","div",null,{"className":"flex","children":[["$","div",null,{"className":"w-[9rem]","children":"blt a b offset"}],["$","div",null,{"children":"If reg A < regB, jump by offset, otherwise continue"}]]}]]}],["$","$Lb",null,{"children":["When a CPU executes instructions, it does so one at a time, in order. To keep track of which instruction we're executing, we use value called the ",["$","em",null,{"children":"program counter"}]," (PC). This is stored in a ",["$","em",null,{"children":"register"}]," as a 32 bit number."]}],["$","$Lb",null,{"children":"Because the PC is an address, it points to a byte (8 bits) in memory. And then since each instruction is 4 bytes long, we'll need to increment the PC by 4 each time we execute an instruction. Let's see this in action:"}],["$","div",null,{"className":"self-center flex flex-col my-2","children":[["$","div",null,{"className":"bg-slate-50 flex flex-col shadow-md","style":{"minWidth":"50rem","minHeight":"16rem"},"children":["$","$Lc",null,{"schematicId":"c-a7yetcbo","readonly":true,"embedded":true,"toolbars":["PlayPause","Viewport"],"children":"$undefined"}]}],["$","div",null,{"className":"flex flex-col justify-center items-center italic mt-2","children":"Fig 1: PC register with a loop-back that gets 4 added to it on each cycle"}]]}],["$","$Lb",null,{"children":["We can see that the output of the PC register is connected to the input of the ",["$","em",null,{"children":"add"}]," component. Combined with the input of the constant value 4, this add component outputs PC + 4. Then, on the next ",["$","em",null,{"children":"cycle"}],", the PC register will take on this value PC + 4 (shown in yellow)."]}],["$","$Lb",null,{"children":["This cycle is driven by a hidden ",["$","em",null,{"children":"clock signal"}],", and occurs each time we click the ",["$","em",null,{"children":"step"}]," button. We'll see more about the clock later. In our simple add-4 loop, the clock signal is only used by the register itself to update its value."]}],["$","$Lb",null,{"children":["OK, great, we've got our program counter incrementing each cycle. Now we need to use it to fetch an ",["$","em",null,{"children":"instruction"}],". We add a ROM component, which contains our program, i.e. our list of instructions. Whenever we supply an address value, we'll return the 32-bit (4 byte) value stored at that address. The blue highlight indicates that address."]}],["$","div",null,{"className":"self-center flex flex-col my-2","children":[["$","div",null,{"className":"bg-slate-50 flex flex-col shadow-md","style":{"minWidth":"70rem","minHeight":"30rem"},"children":["$","$Lc",null,{"schematicId":"c-s1m3zs3x","readonly":true,"embedded":true,"toolbars":["PlayPause","Viewport"],"children":["$","$Ld",null,{"fileName":"blinky2.elf"}]}]}],["$","div",null,{"className":"flex flex-col justify-center items-center italic mt-2","children":"Fig 2: PC register looking up ROM contents"}]]}],["$","$Lb",null,{"children":"So as the PC advances, 4 bytes at a time, we get the next instruction from the ROM to execute. Currently, this will advance non-stop, but that's fine for now."}],["$","$Lb",null,{"children":["Now what do our instructions actually do? One of their basic tasks is to manipulate values stored in a set of ",["$","em",null,{"children":"registers"}],". These are just 32-bit values that can be read from and written to. In the RISC-V 32bit ISA, there are 32 such registers (numbered 0 to 31). We call this set of registers the ",["$","em",null,{"children":"register file"}],"."]}],["$","div",null,{"className":"self-center flex flex-col my-2","children":[["$","div",null,{"className":"bg-slate-50 flex flex-col shadow-md","style":{"minWidth":"70rem","minHeight":"60rem"},"children":["$","$Lc",null,{"schematicId":"reg-file-demo","readonly":true,"embedded":true,"toolbars":["PlayPause","Viewport"],"children":"$undefined"}]}],["$","div",null,{"className":"flex flex-col justify-center items-center italic mt-2","children":"Register File with input & 2 outputs"}]]}],["$","$Lb",null,{"children":["This particular register file has 1 input, and 2 outputs. That is, in a given cycle, we can read any two values simultaneously (including from the same register). We can also write to any single register, whose value will be updated at the start of the next cycle. The one exception is the first register, ",["$","code",null,{"children":"zero"}],": it always outputs zero, and any writes to it are ignored. Give it a go!"]}],["$","$Lb",null,{"children":["Now with our register file in hand, and a way to fetch instructions, we can now take a look at the various instructions in our ",["$","em",null,{"children":"instruction set"}],". Each 32 bit instruction we fetch from the ROM has a specific meaning, which we need to interpret, and act upon. The following sections will take us through the various instruction types, and what we need to add to our computer to support them."]}]]}],["$","$La",null,{"title":"R-Type (register-type) instructions","children":[["$","$Lb",null,{"children":["Let's assume we've already populated our register file with some values. And then we want to take two values, from registers 3 & 4, add them, and then store the result in register 6. To do this, we'll use the RISC-V ",["$","$Le",null,{"children":"add"}]," instruction. The instruction contains several bits of information:"]}],["$","ol",null,{"className":"ml-8 my-4","children":[["$","li",null,{"children":"1. The fact that we're doing an add instruction (as opposed to a subtract, or a jump, or a load from memory, etc)"}],["$","li",null,{"children":"2. The register number of the destination register (6)"}],["$","li",null,{"children":"3. The register number of the first source register (3)"}],["$","li",null,{"children":"4. The register number of the second source register (4)"}]]}],["$","$Lb",null,{"children":["That first bit of info, about it being an ",["$","code",null,{"children":"add"}],", is actually split into two portions. The first of them indicates that it's a register-register instruction (read from 2, write to 1, i.e. an R-Type instruction), and then the second portion indicates it's an add, as opposed to a subtract, shift, and, xor etc. Here's the complete breakdown of the instruction. The other thing to note is that each of the register values is 5 bits long, which allows us to choose between 2^5 = 32 values, i.e. the 32 registers."]}],["$","div",null,{"className":"mx-8 my-4 self-center bg-slate-200 py-2 px-4","children":["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"add  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-blue-600","children":"rs2"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0000000"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"000"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0110011"}]]}]]}]}],["$","$Lb",null,{"children":["The work to take an instruction, and figure out what it means, is called ",["$","em",null,{"children":"instruction decode"}],". We'll use a fully-formed component for this, which can handle all the different instuction types, but for now it will only be able to perform an add operation. We attach our instruction decoder to the output of the ROM, whose address we've selected."]}],["$","div",null,{"className":"h-[10rem] w-[20rem] bg-slate-300 p-8 my-4 self-center","children":"Instruction Decoder hooked up to ROM (but not to registers or ALU)"}],["$","$Lb",null,{"children":["The instruction decode component outputs a whole suite of ",["$","em",null,{"children":"control signals"}],", which are routed to the various other components, telling them what to do. This component is also considered \"combinatorial\", meaning its outputs are wholy determined by its inputs, and don't depend on any internal state. In contrast, the register file is considered \"sequential\", because it has internal state (the values of the registers), and also integrates with the clock signal."]}],["$","$Lb",null,{"children":"For example, the instruction decoder outputs control signals to the register file, telling it which registers to read & write from. It also indicates that we want to do an add operation, which is routed to what we call an `ALU` (arithmetic logic unit)."}],["$","$Lb",null,{"children":"For now, we'll use an add component instead of a full ALU, and it will be always-on."}],["$","div",null,{"className":"h-[10rem] w-[20rem] bg-slate-300 p-8 my-4 self-center","children":"Instruction Decoder hooked up register file, with simple add instruction"}],["$","$Lb",null,{"children":["Now we have a working add instruction! When we step the clock, the instruction decoder tells the register file to read from the two source registers, and then write the result to the destination register. The add component does the actual computation, and the register file updates its internal state. When we encounter a dud instruction like",["$","code",null,{"children":"0x0000_0000"}],", we don't do anything, and when we come to the add instruction, we do the appropriate action."]}],["$","$Lb",null,{"children":"Our 2-register input & 1-register output style of instructions forms a family of R-type (register-type) instructions. They're all quite similar in operation, except for the actual calculation that takes place. Instead of our add component, we'll use a proper ALU component. This does all the other operations we need, like subtract, shift, and, or, etc. From the instruction decoder's perspective, it just passes a few bits directly from the original instruction to the ALU, and then the ALU can use those bits to decide what operation to perform. Below is a table of the R-type instructions we'll be using."}],["$","div",null,{"className":"mx-8 my-4 self-center bg-slate-200 py-2 px-4","children":[["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"add  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-blue-600","children":"rs2"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0000000"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"000"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0110011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"sub  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-blue-600","children":"rs2"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0100000"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"000"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0110011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"sll  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-blue-600","children":"rs2"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0000000"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"001"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0110011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"slt  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-blue-600","children":"rs2"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0000000"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"010"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0110011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"sltu "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-blue-600","children":"rs2"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0000000"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"011"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0110011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"xor  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-blue-600","children":"rs2"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0000000"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"100"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0110011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"srl  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-blue-600","children":"rs2"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0000000"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"101"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0110011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"sra  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-blue-600","children":"rs2"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0100000"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"101"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0110011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"or   "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-blue-600","children":"rs2"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0000000"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"110"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0110011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"and  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-blue-600","children":"rs2"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0000000"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"111"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0110011"}]]}]]}]]}],["$","$Lb",null,{"children":["These 10 instructions can be defined with 4 bits (2^3 = 8: too small; 2^4 = 16: sufficient), so those 4 bits are passed to the ALU. The 4 bits are taken from the 3 \"funct3\" bits (in black), as well as the second bit in the instruction (also in black). The latter bit differentiates between a couple of closely related operations: add vs subtract, and shift-right-logical vs shift-right-arithmetic. We also pass a few extra bits to the ALU, which tell it whether to do anything at all, as well as whether it should produce a ",["$","em",null,{"children":"branch"}]," bit. Let's hook up the ALU, and see it in action:"]}],["$","div",null,{"className":"h-[10rem] w-[20rem] bg-slate-300 p-8 my-4 self-center","children":"Instruction Decoder hooked up to ALU, with several R-type instructions"}]]}],["$","$La",null,{"title":"I-Type (immediate-type) instructions","children":[["$","$Lb",null,{"children":"So far, we've assumed the register file is already populated with values. But normally, such a register file gets reset to all zeros, and with all of the R-Type instructions, there'd be no way to change any of them to anything other than zero. So to help with that, we introduce a new type of instruction, called an I-Type (immediate-type) instruction. These instructions are similar to R-Type instructions, except instead of taking two register values as inputs, they take one register value, and one immediate value."}],["$","$Lb",null,{"children":["The word ",["$","em",null,{"children":"immediate"}]," just means that the value is stored directly in the instruction itself, rather than taken from a register. Ideally we'd like to set a register to any 32-bit value, but since the instruction itself is 32 bits long, we can only use a few of those bits. Let's account for what the other bits are used for:"]}],["$","ol",null,{"className":"ml-8 my-4","children":[["$","li",null,{"children":"7 bits: the instruction type (I-type)"}],["$","li",null,{"children":"3 bits: the ALU operation (add, shift, and, or, ...)"}],["$","li",null,{"children":"5 bits: the source register for the LHS"}],["$","li",null,{"children":"5 bits: the destination register"}]]}],["$","$Lb",null,{"children":"Those take up a total of 20 bits, leaving 12 bits for the immediate value, and our addi instruction (for example) looks like this:"}],["$","div",null,{"className":"mx-8 my-4 self-center bg-slate-200 py-2 px-4","children":[["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"addi "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiii"}],["$","span","1",{"className":"text-green-600","children":"aaaaa"}],["$","span","2",{"className":"text-black font-bold","children":"000"}],["$","span","3",{"className":"text-yellow-600","children":"ddddd"}],["$","span","4",{"className":"text-red-600 font-bold","children":"0010011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"slti "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiii"}],["$","span","1",{"className":"text-green-600","children":"aaaaa"}],["$","span","2",{"className":"text-black font-bold","children":"010"}],["$","span","3",{"className":"text-yellow-600","children":"ddddd"}],["$","span","4",{"className":"text-red-600 font-bold","children":"0010011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"sltiu"}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiii"}],["$","span","1",{"className":"text-green-600","children":"aaaaa"}],["$","span","2",{"className":"text-black font-bold","children":"011"}],["$","span","3",{"className":"text-yellow-600","children":"ddddd"}],["$","span","4",{"className":"text-red-600 font-bold","children":"0010011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"xori "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiii"}],["$","span","1",{"className":"text-green-600","children":"aaaaa"}],["$","span","2",{"className":"text-black font-bold","children":"100"}],["$","span","3",{"className":"text-yellow-600","children":"ddddd"}],["$","span","4",{"className":"text-red-600 font-bold","children":"0010011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"ori  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiii"}],["$","span","1",{"className":"text-green-600","children":"aaaaa"}],["$","span","2",{"className":"text-black font-bold","children":"110"}],["$","span","3",{"className":"text-yellow-600","children":"ddddd"}],["$","span","4",{"className":"text-red-600 font-bold","children":"0010011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"andi "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiii"}],["$","span","1",{"className":"text-green-600","children":"aaaaa"}],["$","span","2",{"className":"text-black font-bold","children":"111"}],["$","span","3",{"className":"text-yellow-600","children":"ddddd"}],["$","span","4",{"className":"text-red-600 font-bold","children":"0010011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"slli "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0000000"}],["$","span","1",{"className":"text-purple-600","children":"iiiii"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"001"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0010011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"srli "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0000000"}],["$","span","1",{"className":"text-purple-600","children":"iiiii"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"101"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0010011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"srai "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-black font-bold","children":"0100000"}],["$","span","1",{"className":"text-purple-600","children":"iiiii"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"101"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0010011"}]]}]]}]]}],["$","$Lb",null,{"children":"Instead of using two values from the register file, we use one value from the register file, and one from the instruction-decode, which the instruction-decoder expands from the 12-bit immediate value into a full 32-bit value. That value is then passed into the ALU. Like the R-type instruction, the ALU result then feeds back into the register file."}],["$","$Lb",null,{"children":["Before we had 10 instructions, and now we only have 9. Compared to the R-type instructions, the I-type instructions lack a ",["$","code",null,{"children":"subtract"}]," operation. This turns out to be fine, since we can just use the ",["$","code",null,{"children":"addi"}]," instruction with a negative immediate value. However, we still need the 4th bit to differentiate between shift-right-logical and shift-right-arithmetic. This turns out to be doable, since all the shift instructions only need a 5-bit immediate value (we're only operating on 32 bit values, so the maximum shift is 2^5 = 32), and we can use the instruction's bit-2 as before."]}],["$","$Lb",null,{"children":["So for R-type, the RHS comes from the register file, and for I-type, the RHS comes from the immediate value. Therefore we need to select between these two. To do that, we use a ",["$","em",null,{"children":"mux"}]," (multiplexer) component. This particular version is a 2-input, 32-bit mux, meaning it can select between two inputs, and output one of them, operating on the 32 values in concert. To select between 2 inputs, we only need a single bit."]}],["$","div",null,{"className":"h-[10rem] w-[20rem] bg-slate-300 p-8 my-4 self-center","children":"Mux (multiplexer) with 2 inputs, driven by a selector bit"}],["$","$Lb",null,{"children":"Now we can use this mux to select between the two inputs to the ALU. The instruction decoder will tell the mux whether to select the immediate value, or the register value."}],["$","div",null,{"className":"h-[10rem] w-[20rem] bg-slate-300 p-8 my-4 self-center","children":"Ins-decode selecting between I-type & R-type instructions"}],["$","$Lb",null,{"children":"This program can now load several values into registers using the addi instruction, and then use the R-type instructions to operate on them to produce a new value. Great, we're making progress."}]]}],["$","$La",null,{"title":"B-type (branching) instructions","children":[["$","$Lb",null,{"children":"The next instruction type we'll support is the B-type (branching) instruction. This is the first time we'll be making the PC register change to something other than PC + 4. This instruction forms the basis of things like if/else statements and for-loops. The instruction is a bit like the I-type instruction: it contains two register values and an immediate. However, the 2 registers represent two values to compare (i.e. reads), and the immediate is used as an address offset. Here's the breakdown:"}],["$","div",null,{"className":"mx-8 my-4 self-center bg-slate-200 py-2 px-4","children":[["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"beq  "}],[["$","span","0",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","1",{"className":"px-1 text-blue-600","children":"rs2"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"i"}],["$","span","1",{"className":"text-purple-600","children":"iiiiii"}],["$","span","2",{"className":"text-blue-600","children":"bbbbb"}],["$","span","3",{"className":"text-green-600","children":"aaaaa"}],["$","span","4",{"className":"text-black font-bold","children":"000"}],["$","span","5",{"className":"text-purple-600","children":"iiiiii"}],["$","span","6",{"className":"text-purple-600","children":"i"}],["$","span","7",{"className":"text-red-600 font-bold","children":"1100011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"bne  "}],[["$","span","0",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","1",{"className":"px-1 text-blue-600","children":"rs2"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"i"}],["$","span","1",{"className":"text-purple-600","children":"iiiiii"}],["$","span","2",{"className":"text-blue-600","children":"bbbbb"}],["$","span","3",{"className":"text-green-600","children":"aaaaa"}],["$","span","4",{"className":"text-black font-bold","children":"001"}],["$","span","5",{"className":"text-purple-600","children":"iiiiii"}],["$","span","6",{"className":"text-purple-600","children":"i"}],["$","span","7",{"className":"text-red-600 font-bold","children":"1100011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"blt  "}],[["$","span","0",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","1",{"className":"px-1 text-blue-600","children":"rs2"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"i"}],["$","span","1",{"className":"text-purple-600","children":"iiiiii"}],["$","span","2",{"className":"text-blue-600","children":"bbbbb"}],["$","span","3",{"className":"text-green-600","children":"aaaaa"}],["$","span","4",{"className":"text-black font-bold","children":"100"}],["$","span","5",{"className":"text-purple-600","children":"iiiiii"}],["$","span","6",{"className":"text-purple-600","children":"i"}],["$","span","7",{"className":"text-red-600 font-bold","children":"1100011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"bge  "}],[["$","span","0",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","1",{"className":"px-1 text-blue-600","children":"rs2"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"i"}],["$","span","1",{"className":"text-purple-600","children":"iiiiii"}],["$","span","2",{"className":"text-blue-600","children":"bbbbb"}],["$","span","3",{"className":"text-green-600","children":"aaaaa"}],["$","span","4",{"className":"text-black font-bold","children":"101"}],["$","span","5",{"className":"text-purple-600","children":"iiiiii"}],["$","span","6",{"className":"text-purple-600","children":"i"}],["$","span","7",{"className":"text-red-600 font-bold","children":"1100011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"bltu "}],[["$","span","0",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","1",{"className":"px-1 text-blue-600","children":"rs2"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"i"}],["$","span","1",{"className":"text-purple-600","children":"iiiiii"}],["$","span","2",{"className":"text-blue-600","children":"bbbbb"}],["$","span","3",{"className":"text-green-600","children":"aaaaa"}],["$","span","4",{"className":"text-black font-bold","children":"110"}],["$","span","5",{"className":"text-purple-600","children":"iiiiii"}],["$","span","6",{"className":"text-purple-600","children":"i"}],["$","span","7",{"className":"text-red-600 font-bold","children":"1100011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"bgeu "}],[["$","span","0",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","1",{"className":"px-1 text-blue-600","children":"rs2"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"i"}],["$","span","1",{"className":"text-purple-600","children":"iiiiii"}],["$","span","2",{"className":"text-blue-600","children":"bbbbb"}],["$","span","3",{"className":"text-green-600","children":"aaaaa"}],["$","span","4",{"className":"text-black font-bold","children":"111"}],["$","span","5",{"className":"text-purple-600","children":"iiiiii"}],["$","span","6",{"className":"text-purple-600","children":"i"}],["$","span","7",{"className":"text-red-600 font-bold","children":"1100011"}]]}]]}]]}],["$","$Lb",null,{"children":"We pass the two register values to the ALU, and perform a comparison on them. There are a few different comparison types, and each of them produces a 1-bit value: \"Is the condition met?\". We then use this 1-bit value to choose whether we want to jump or not."}],["$","$Lb",null,{"children":["The instruction decoder is already sending the ALU a ",["$","em",null,{"children":"branch"}]," bit, which tells it to output a 1-bit value, and now we need to wire that output value to a mux. That mux can then select between the ",["$","code",null,{"children":"PC + 4"}]," value, and the ",["$","code",null,{"children":"PC + offset"}]," value. Since they're both offsets, we can select between ",["$","code",null,{"children":"4"}]," & ",["$","code",null,{"children":"offset"}],", where the offset comes from the instruction decoder."]}],["$","div",null,{"className":"h-[10rem] w-[20rem] bg-slate-300 p-8 my-4 self-center","children":"Ins-decode with branching"}],["$","$Lb",null,{"children":"Now we can hop around our program, and the path we take depends on the values in the registers. Step through a few of the programs to see them in action."}]]}],["$","$La",null,{"title":"J-type (jump) instructions","children":[["$","$Lb",null,{"children":"The next important instruction type is the J-type (jump) instruction. These are called \"unconditional\" jumps, because they always jump, rather than only jumping if a condition is met. There are a couple of different types of jump instructions:"}],["$","div",null,{"className":"mx-8 my-4 self-center bg-slate-200 py-2 px-4","children":[["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"jal  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"i"}],["$","span","1",{"className":"text-purple-600","children":"iiiiiiiiii"}],["$","span","2",{"className":"text-purple-600","children":"i"}],["$","span","3",{"className":"text-purple-600","children":"iiiiiiii"}],["$","span","4",{"className":"text-yellow-600","children":"ddddd"}],["$","span","5",{"className":"text-red-600 font-bold","children":"1101111"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"jalr "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiii"}],["$","span","1",{"className":"text-green-600","children":"aaaaa"}],["$","span","2",{"className":"text-black font-bold","children":"000"}],["$","span","3",{"className":"text-yellow-600","children":"ddddd"}],["$","span","4",{"className":"text-red-600 font-bold","children":"1100111"}]]}]]}]]}],["$","$Lb",null,{"children":["These two, ",["$","$Le",null,{"children":"jal"}]," (jump & link) and ",["$","$Le",null,{"children":"jalr"}]," (jump & link register), are fairly similar. They both jump to a new address (the jump part), and they both store the value ",["$","code",null,{"children":"PC + 4"}]," in a register (the link part). The difference is that",["$","$Le",null,{"children":"jal"}]," calculates the new address as ",["$","code",null,{"children":"PC + 20-bit-imm"}],", and ",["$","$Le",null,{"children":"jalr"}]," calculates it as ",["$","code",null,{"children":"reg[rs1] + 12-bit-imm"}],"."]}],["$","$Lb",null,{"children":"In order to implement these instructions, we'll use the ALU to calculate the new address. For the jal instruction, we'll need to include a mux to change between taking the LHS value from either the PC or the register file (The inputs are already available for jalr). We'll add a control signal to this new mux as well."}],["$","div",null,{"className":"h-[10rem] w-[20rem] bg-slate-300 p-8 my-4 self-center","children":"Add PC mux wires"}],["$","$Lb",null,{"children":["To handle the ALU results, we need to add a couple more mux's. Normally, ",["$","code",null,{"children":"PC + [offset]"}]," goes back to PC, and ALU output goes to the register file. But for our jump instructions, we do the opposite: ",["$","code",null,{"children":"PC + [offset]"}]," goes to the register file, and ALU output goes to PC. To do this, we can use a couple of mux's to select the correct source. This can be controlled by a single signal from the instruction decoder."]}],["$","div",null,{"className":"h-[10rem] w-[20rem] bg-slate-300 p-8 my-4 self-center","children":"Add result switching"}],["$","$Lb",null,{"children":["These instructions can seem a bit odd at first, but they're rather powerful. Their basic use is to call into and return from functions. How we do this is: executa a ",["$","code",null,{"children":"jal"}]," instruction with it's imm value set to an offset that is the start of the function, and set the dest register of ",["$","code",null,{"children":"PC + 4"}]," to be the ",["$","code",null,{"children":"ra"}],", or \"return address\" register (index = 1). The PC then starts executing the instructions. When we want to return to the calling code, we simply execute ",["$","code",null,{"children":"jalr 0, ra, 0"}],", which jumps to the address stored in ",["$","code",null,{"children":"ra"}],". Since ",["$","code",null,{"children":"ra"}],"contained ",["$","code",null,{"children":"PC + 4"}]," when we first jumped, the return address is the instruction immediately after the initial ",["$","code",null,{"children":"jal"}]," instruction."]}]]}],["$","$La",null,{"title":"Upper-immediate instructions","children":[["$","$Lb",null,{"children":["So far, we've only been able to load 12-bit values immediate values into registers. Typically this is done with ",["$","code",null,{"children":"addi rd, 0, imm"}],", i.e. adding 0 to the immediate value. But what if we want to load a 32-bit value? We could do several addi's & shifts, but RISCV provides instructions to set the remaining upper 20 bits:"]}],["$","div",null,{"className":"mx-8 my-4 self-center bg-slate-200 py-2 px-4","children":[["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"lui  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiiiiiiiiiii"}],["$","span","1",{"className":"text-yellow-600","children":"ddddd"}],["$","span","2",{"className":"text-red-600 font-bold","children":"0110111"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"auipc"}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiiiiiiiiiii"}],["$","span","1",{"className":"text-yellow-600","children":"ddddd"}],["$","span","2",{"className":"text-red-600 font-bold","children":"0010111"}]]}]]}]]}],["$","$Lb",null,{"children":["The first one, ",["$","$Le",null,{"children":"lui"}]," (load upper immediate), sets the upper 20 bits of a register to the immediate value provided. We can do this simply by setting the LHS to 0, and the RHS to the immediate value. Since these wires are 32-bits in width, the mapping to the upper bits happens entirely in INS-decode."]}],["$","$Lb",null,{"children":["The second one, ",["$","$Le",null,{"children":"auipc"}]," (add upper immediate to PC), is essentially the same, except the LHS is set to the PC. Luckily, we don't need any changes, as we already have the mux used to select between PC & register file for the LHS."]}]]}],["$","$La",null,{"title":"Load/Store instructions","children":[["$","$Lb",null,{"children":"Right now, our CPU can't do much. It can load values into registers, operate on them, and jump around the code. The next major thing is to be able to read & write to memory. This is actually quite powerful, as addresses don't necessarily need to map to physical memory, but can instead control external devices."}],["$","$Lb",null,{"children":"To access memory, RISCV provides a couple of types of instruction: load & store."}],["$","ul",null,{"className":"self-center my-4","children":[["$","li",null,{"children":[["$","b",null,{"children":"Load:"}]," memory@address --> register"]}],["$","li",null,{"children":[["$","b",null,{"children":"Store:"}]," register --> memory@address"]}]]}],["$","$Lb",null,{"children":"So to do any computations on data, we first need to load it into a register from memory, then operate on it, before storing the result back into memory. The RISVC instructions for this are as follows:"}],["$","div",null,{"className":"mx-8 my-4 self-center bg-slate-200 py-2 px-4","children":[["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"lb   "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiii"}],["$","span","1",{"className":"text-green-600","children":"aaaaa"}],["$","span","2",{"className":"text-black font-bold","children":"000"}],["$","span","3",{"className":"text-yellow-600","children":"ddddd"}],["$","span","4",{"className":"text-red-600 font-bold","children":"0000011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"lh   "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiii"}],["$","span","1",{"className":"text-green-600","children":"aaaaa"}],["$","span","2",{"className":"text-black font-bold","children":"001"}],["$","span","3",{"className":"text-yellow-600","children":"ddddd"}],["$","span","4",{"className":"text-red-600 font-bold","children":"0000011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"lw   "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiii"}],["$","span","1",{"className":"text-green-600","children":"aaaaa"}],["$","span","2",{"className":"text-black font-bold","children":"010"}],["$","span","3",{"className":"text-yellow-600","children":"ddddd"}],["$","span","4",{"className":"text-red-600 font-bold","children":"0000011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"lbu  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiii"}],["$","span","1",{"className":"text-green-600","children":"aaaaa"}],["$","span","2",{"className":"text-black font-bold","children":"100"}],["$","span","3",{"className":"text-yellow-600","children":"ddddd"}],["$","span","4",{"className":"text-red-600 font-bold","children":"0000011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"lhu  "}],[["$","span","0",{"className":"px-1 text-yellow-600","children":"rd"}],["$","span","1",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiiiiiiii"}],["$","span","1",{"className":"text-green-600","children":"aaaaa"}],["$","span","2",{"className":"text-black font-bold","children":"101"}],["$","span","3",{"className":"text-yellow-600","children":"ddddd"}],["$","span","4",{"className":"text-red-600 font-bold","children":"0000011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"sb   "}],[["$","span","0",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","1",{"className":"px-1 text-blue-600","children":"rs2"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiii"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"000"}],["$","span","4",{"className":"text-purple-600","children":"iiiii"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0100011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"sh   "}],[["$","span","0",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","1",{"className":"px-1 text-blue-600","children":"rs2"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiii"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"001"}],["$","span","4",{"className":"text-purple-600","children":"iiiii"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0100011"}]]}]]}],["$","div",null,{"className":"flex font-mono","children":[["$","div",null,{"className":"w-[10rem]","children":[["$","span",null,{"className":"pr-1","children":"sw   "}],[["$","span","0",{"className":"px-1 text-green-600","children":"rs1"}],["$","span","1",{"className":"px-1 text-blue-600","children":"rs2"}],["$","span","2",{"className":"px-1 text-purple-600","children":"imm"}]]]}],["$","span",null,{"className":"ml-4","children":[["$","span","0",{"className":"text-purple-600","children":"iiiiiii"}],["$","span","1",{"className":"text-blue-600","children":"bbbbb"}],["$","span","2",{"className":"text-green-600","children":"aaaaa"}],["$","span","3",{"className":"text-black font-bold","children":"010"}],["$","span","4",{"className":"text-purple-600","children":"iiiii"}],["$","span","5",{"className":"text-red-600 font-bold","children":"0100011"}]]}]]}]]}],["$","$Lb",null,{"children":"There are a few different types of load & store instructions. The main breakdown is that there are 3 different sizes of data that can be loaded/stored: 8-bit (b; \"byte\"), 16-bit (h; \"half-word\"), and 32-bit (w; \"word\"). The byte & half-word sizes also have unsigned versions, as for the other ones, we sign-extend the value to 32-bits."}],["$","$Lb",null,{"children":"In all cases, the memory address is calculated as (reg[rs1] + imm). For our CPU, we won't use the ALU for this addition, but instead include an adder in the load/store component. We'll feed in the LHS value (reg[rs1]), into the load/store. We also feed reg[rs2] into the load/store for stores. Finally, for loads, we send the result to the registers in the same manner as the ALU results."}],["$","$Lb",null,{"children":"Let's take a look at the RAM (memory) component that we'll be interfacing with. It's a simple component that takes an address, some control lines, and a bi-directional data line. The data line is used for both reads & writes, so that in any given cycle, it can either read or write the provided address. The choice of reading or writing (or neither) is controlled by the control lines. Finally, writing can be done in either 8-bit, 16-bit, or 32-bit chunks, also controlled by the control lines."}],["$","div",null,{"className":"h-[10rem] w-[20rem] bg-slate-300 p-8 my-4 self-center","children":"RAM control"}],["$","$Lb",null,{"children":"To hook this RAM to our CPU, we add our load/store component and wire it up to the address/data/ctrl bus, as well as the CPU internals. We can now execute our load & store instructions to read & write to the memory."}],["$","div",null,{"className":"h-[10rem] w-[20rem] bg-slate-300 p-8 my-4 self-center","children":"RAM & load/store connected"}],["$","$Lb",null,{"children":["This enables us to write programs that can access memory, and therefore do useful things. In our setup here, the address 0x0 refers to the first 32-bit value in RAM and 0x4 refers to the second 32-bit value in RAM. This isn't that great, since our ROM ",["$","em",null,{"children":"also"}]," has its first 32-bit value at address 0x0 (where the PC is initialized to). Generally when setting up a system like this, we want non-overlapping address spaces for our different regions of memory, and compilers will typically complain if this is not the case."]}]]}]]}],null],"segment":"__PAGE__"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/llm-viz/_next/static/css/8ac2c1261f4ff59a.css","precedence":"next"}]]}],"segment":"01-riscv-basic"},"styles":[]}],["$","div",null,{"id":"portal-container"}]],null],"segment":"guide"},"styles":[]}],"segment":"cpu"},"styles":[]}],"params":{}}],null]
3:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"RISC-V Minimal Computer - CPU Guide"}],["$","meta","2",{"name":"description","content":"Basics of RISC-V CPU model"}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","4",{"rel":"icon","href":"/llm-viz/icon.png?9d3d9b98e68d2d0d","type":"image/png","sizes":"16x16"}]]
8:null
